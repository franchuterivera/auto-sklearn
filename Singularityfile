Bootstrap: docker
From: ubuntu:18.04
%files
. /bench/

%post
DEBIAN_FRONTEND=noninteractive
apt-get update
apt-get -y install apt-utils dialog locales
apt-get -y install curl wget unzip git
apt-get -y install software-properties-common
add-apt-repository -y ppa:deadsnakes/ppa
apt-get update
apt install -y swig3.0
ln -s /usr/bin/swig3.0 /usr/bin/swig
apt-get -y install python3.8 python3.8-venv python3.8-dev python3-pip
update-alternatives --install /usr/bin/python3 python3 $(which python3.8) 1
python3 --version
pip3 install -U pip wheel
# aliases for the python system
# Enforce UTF-8 encoding
PYTHONUTF8=1
PYTHONIOENCODING=utf-8
LANG=C.UTF-8
LC_ALL=C.UTF-8
cd /bench
# We create a virtual environment so that AutoML systems may use their preferred versions of
# packages that we need to data pre- and postprocessing without breaking it.
python3 -m venv venv
mkdir /input
mkdir /output
mkdir /custom
xargs -L 1 pip3 install --no-cache-dir < requirements.txt
python3 setup.py install

%environment
export DEBIAN_FRONTEND=noninteractive
export PYTHONUTF8=1
export PYTHONIOENCODING=utf-8
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
export OPENBLAS_NUM_THREADS=1
export MKL_NUM_THREADS=1
export BLAS_NUM_THREADS=1
export OMP_NUM_THREADS=1

%runscript
cd /bench
exec /bin/bash -c "python3 test_grid.py ""$@"
